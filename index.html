const csvFileURL = 'https://raw.githubusercontent.com/lehunghup/webmeoooe/main/data%20-%20Copy.csv';
const mediaGrid = document.getElementById('mediaGrid');
const errorMessage = document.getElementById('errorMessage');
let mediaData = [];

function loadMediaData() {
    fetch(csvFileURL)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(csvText => {
            const results = Papa.parse(csvText, { header: true, dynamicTyping: true });
            if (results.errors.length > 0) {
                console.error("CSV Parsing Errors:", results.errors);
                errorMessage.textContent = "Error parsing CSV file.";
                return;
            }
            mediaData = results.data;
            displayMedia(mediaData);
        })
        .catch(error => {
            console.error("Error fetching CSV:", error);
            errorMessage.textContent = "Failed to load media data.";
        });
}

function displayMedia(data) {
    mediaGrid.innerHTML = ''; // Clear existing content
    data.forEach(item => {
        const mediaElement = document.createElement('div');
        mediaElement.classList.add('media-item');

        if (item.url.endsWith('.jpg') || item.url.endsWith('.png') || item.url.endsWith('.gif')) {
            const img = document.createElement('img');
            img.src = item.url;
            img.alt = item.title || 'Image';
            mediaElement.appendChild(img);
        } else if (item.url.endsWith('.mp4') || item.url.endsWith('.webm') || item.url.endsWith('.ogg')) {
            const video = document.createElement('video');
            video.src = item.url;
            video.controls = true;
            mediaElement.appendChild(video);
        } else {
            const link = document.createElement('a');
            link.href = item.url;
            link.textContent = item.title || 'Link';
            mediaElement.appendChild(link);
        }

        const titleElement = document.createElement('h3');
        titleElement.textContent = item.title || 'No Title';
        mediaElement.appendChild(titleElement);

        // Thêm các thông tin khác bạn muốn hiển thị từ CSV

        mediaGrid.appendChild(mediaElement);
    });
}

function sortMedia() {
    const sortBy = document.getElementById('sort').value;
    let sortedData = [...mediaData]; // Create a copy to avoid modifying the original array

    sortedData.sort((a, b) => {
        if (a[sortBy] < b[sortBy]) return -1;
        if (a[sortBy] > b[sortBy]) return 1;
        return 0;
    });

    displayMedia(sortedData);
}

// Call loadMediaData when the page loads
window.onload = loadMediaData;

// Nếu bạn không muốn người dùng tải file lên, bạn có thể xóa hoặc comment đoạn này
// function loadCSV() {
//     const file = document.getElementById('csvFile').files[0];
//     if (file) {
//         Papa.parse(file, {
//             header: true,
//             dynamicTyping: true,
//             complete: function(results) {
//                 mediaData = results.data;
//                 displayMedia(mediaData);
//             },
//             error: function(error) {
//                 console.error("CSV Parsing Error:", error);
//                 errorMessage.textContent = "Error parsing CSV file.";
//             }
//         });
//     }
// }

function openModal(videoUrl, title) {
    const modal = document.getElementById('videoModal');
    const modalVideo = document.getElementById('modalVideo');
    const videoTitle = document.getElementById('videoTitle');
    modalVideo.src = videoUrl;
    videoTitle.textContent = title;
    modal.style.display = "block";
}

function closeModal() {
    const modal = document.getElementById('videoModal');
    const modalVideo = document.getElementById('modalVideo');
    modalVideo.pause();
    modalVideo.currentTime = 0;
    modal.style.display = "none";
}

window.onclick = function(event) {
    const modal = document.getElementById('videoModal');
    if (event.target == modal) {
        closeModal();
    }
}
